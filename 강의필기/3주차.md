## TCP/IP Protocol Suite

- 인터넷에서 컴퓨터들이 서로 정보를 주고받는 데 쓰이는 프로토콜의 집합
- 
- 주로 4계층 모델 or 7계층 구조로 설명한다.
  * 4계층은 application, transport, internet, network 이다.
  * 7계층은 application, presentation, session, transport, network, datalink, physical 이다.

이미지로 보면 다음과 같다.

![image](https://github.com/Jaeboong/Study/assets/158824294/4ab8c8f7-c385-4538-bb7d-173402cb221e)

### 데이터 전송 방식

![image](https://github.com/Jaeboong/Study/assets/158824294/a7a854f3-c57d-4f17-a7b2-3e0d189eba47)

Link1 과 같은 박스를 동네라도 부르겠다.

Link1에서 통신을 하면 같은 동네끼리만 통신이 가능하다.

다른 동네와 통신을 하려면 라우터를 걸쳐 길을 찾아 통신을 해야한다.

R1 과 같은 것을 라우터라고 하며 라우터는 길을 찾는 역할을 한다.

![image](https://github.com/Jaeboong/Study/assets/158824294/80dea268-374b-4da3-9d0b-68d3ae100150)

위 그림은 physical layer에서 보는 A->B로의 데이터 전송 방식이다.

A에서 B로 데이터를 전달할 때 A의 physical layer는 A에서 R1으로 비트를 보내는 것에 집중한다.

A가 B로 데이터를 전달할 때 다른 동네 디바이스들도 A가 보내는 신호를 들을 수 있다. 하지만 신호를 받고 본인에게 온 것이 아니라면 무시한다.

만약 무시하지 않고 이것을 건드린다면 해킹이다.

![image](https://github.com/Jaeboong/Study/assets/158824294/81f00ef2-d0e1-4b8b-9198-69ba8ab2ffa9)

위 그림은 datalink layer에서의 A->B 로의 데이터 전송 방식이다.

physical layer와는 달리 비트 대신 frame을 전달하는 것에 집중한다.

![image](https://github.com/Jaeboong/Study/assets/158824294/7dd83a89-bec5-4ace-9104-0942a1c1f402)

다음은 network layer에서의 A->B 로의 데이터 전송 방식이다.

datalink layer와 보내는 방식은 같지만 표현 방식이 다르다.

network layer에서는 datagram을 전송한다고 표현한다. 그리고 datalink layer와는 다르게 A와 B가 끊어져있지 않고 연결되어 있는 것으로 표현된다. 상황에 따라 datagram이 아니라 segment라고도 표현된다.

![image](https://github.com/Jaeboong/Study/assets/158824294/aa684882-ed6b-4234-a05f-8eced6f42bea)

다음은 transport layer에서의 A->B 데이터 전송 방식이다.

transport layer에서도 역시 데이터의 전송 방식은 같다. 특정 프로토콜에 따라 segment, datagram, packet으로 부른다.

## TCP/IP Protocol Suite and OSI Model

* Application / Presentation / Session
  * SMTP, FTP, HTTP, DNS, SNMP, TELNET
* Transport
  * SCTP(X), TCP, UDP
* Network
  * ICMP, IGMP, IP, RARP, ARP
* Datalink, Physical -> Protocol defined by the underlying networks

## 7 layer of OSI Model

컴퓨터는 다른 컴퓨터와 데이터를 주고 받는다. 즉 통신을 할 수 있다. 이 통신에는 범위가 존재한다.

- LAN(Local Area Network): 컴퓨터간 근거리 통신
- WAN(Wide Area Network): 컴퓨터 간 광역 통신

이외에도 여러가지 범위가 존재한다. 어쨌든 예를 들어 우리는 컴퓨터로 와이파이 LAN카드로 와이파이 허브와 통신을 한다. 그리고 통신사에 일정 요금을 지불하고 인터넷을 사용한다. 각종 통신사가 케이블을 깔아서 유선 광역 네트워크를 제공해주는 것이다. 당연히 무선도 존재한다.

이런 환경에서 컴퓨터 간 데이터를 주고 받는데, 그냥 주고 받는 게 아니고 일정 규칙을 지키며 통신을 한다. 이 일정한 규칙을 프로토콜(Protocol)이라고 한다. 이중에서 ISO(국제표준화기구)에서 표준으로 지정한 프로토콜이 존재하는데, 이걸 OSI Model이라고 한다. 계층 형태로 존재하기 때문에 흔히 OSI 7 계층이라고 부른다. 다양한 컴퓨터 간 통신(데이터 송수신)을 지원하는 추상 모델을 표준화한 것이다.

![image](https://github.com/Jaeboong/Study/assets/158824294/284e268f-959a-4d09-a44f-6011d4462977)

보통 컴퓨터 어플리케이션에서 데이터를 전송하면 다른 컴퓨터 어플리케이션이 데이터를 수신한다. send할 때는 Application layer부터 아래로 쭉 내려가서 Physical layer에서 다른 컴퓨터의 Physical layer로 이동한다. 그 다음 맨 밑에서부터 다시 쭉 올라가서 다른 컴퓨터의 application layer에 도달해서 데이터를 수신한다.

![image](https://github.com/Jaeboong/Study/assets/158824294/97951c4b-4573-40ab-a4bb-30965afc03a6)

프로토콜은 header와 body(data) 부분으로 구분되는데, 여러 계층을 거치면서 각 layer의 정보들을 header에 넣어서 차곡차곡 쌓는다. 이 전체를 network stack이라고 표현한다.

### Physical Layer

OSI 모델의 최하위 계층은 물리 계층이다. 장치 간 실제 물리적 연결을 담당한다. 물리 계층은 비트 형태의 정보를 포함하는데, 데이터링크 계층으로부터 신호를 수신해 0과 1로 변환하고 데이터 링크 계층으로 보내 프레임을 다시 결합한다.

Hub, Repeater, Modem, Cables은 모두 물리 계층 장치이다.

### Data Link Layer

데이터 링크 계층은 메시지의 노드 간 전달을 담당한다. 물리 계층을 통한 노드 간 데이터 전송에 오류가 없는지 확인하는 역할을 한다. 패킷이 네트워크에 도착하면 DLL은 이를 MAC 주소를 사용해 호스트로 전달해야 한다.

DLL은 2개의 하위 계층을 갖는다.

-- Logical Link Control (LLC)

-- Media Access Control (MAC)

네트워크 계층에서 받은 패킷은 NIC(Network Intetface Card)의 프레임 크기에 따라 다시 프레임으로 나뉜다. DLL은 또한 송신자와 수신자의 MAC 주소를 헤더에 캡슐화한다.

데이터 링크 계층의 패킷을 프레임이라고 한다.

물리 계층과 데이터 링크 계층 모두 하나의 프로토콜을 사용한다. 이더넷 프로토콜(ethernet protocol). 우리가 사용하는 하드웨어 장치의 각각의 랜카드에는 MAC 주소가 정의되어 있고, 이 MAC 주소는 하드웨어마다 유일한 주소로 정의되어 있다.

이더넷 헤더에 송신할 MAC 주소(Source MAC Address)와 수신할 MAC 주소(Destination MAC Address)를 같이 넣어서 전송하고, 수신 컴퓨터에서 두 MAC 주소를 확인 후 일치하면 데이터를 위로 올려보낸다.

### Network Layer

네트워크 계층은 한 호스트에서 다른 네트워크에 있는 호스트에게로 데이터를 전송하는 데 사용된다. 즉, 사용 가능한 경로 수에서 패킷을 전송할 최단 경로 선택을 처리한다(packet routing). 수많은 컴퓨터 간 논리적인 연결을 위해 네트워크 계층이 필요하다.

네트워크 계층의 기능

-- 1. Routing 기능 : 네트워크 계층 프로토콜은 source에서 destination까지 적합한 경로를 결정한다.

-- 2. Logical Addressing 기능 : 네트워크 간 각 장치를 고유하게 식별하기 위해 네트워크 계층은 주소 지정 체계(an addressing scheme)를 정의한다. 발신자와 수신자의 IP 주소는 네트워크 계층에 의해 헤더에 배치된다.

네트워크 계층에서의 Segment를 패킷(Packet)이라고 한다. 데이터 링크 계층 이하에 있는 데이터는 프레임, 네트워크 계층까지 포함한 데이터를 패킷이라고 하는데, 네트워크 계층까지가 물리적 처리를 담당하므로 7개 layer가 있는 데이터도 보통 패킷으로 통칭하기도 한다.

네트워크 계층은 routers와 같은 네트워킹 장치에 의해 구현된다. 네트워크 계층의 대표적인 프로토콜이 IP 프로토콜이다.

### Transport Layer

전송 계층은 네트워크 계층에서 services를 받아서 어플리케이션 계층에 services를 제공한다. 전송 계층의 데이터를 Segments라고 한다. 전송 계층은 운영체제에서 동작한다. 운영체제의 일부이며 system calls을 통해 어플리케이션 계층과 통신한다. 전송 계층은 OSI 모델의 심장이라고 불린다.

- 성공적인 데이터 전송에 대한 승인을 제공하고 오류가 발견되면 데이터를 재전송한다. 즉, 데이터 전송 중 손상/유실에 대해 점검을 할 수 있다(checksum).
- 수많은 어플리케이션 중 정확히 특정 어플리케이션에 전달하기 위해 port 번호를 통해 식별한다.

발신자 쪽에서는 상위 계층에서 데이터를 받아 Segmentation 과정을 통해 안전한 데이터 전송을 보장하고, 헤더에 Source Port와 Destination port 번호를 추가해 segmented data를 네트워크 계층으로 보낸다. 즉, 발신 측에서 수신자 어플리케이션 쪽의 port 번호를 알아야 하지만 일반적으로 통용되는 번호를 사용한다.

=> 예를 들어, 웹 서버는 보통 80번을 사용하고, 이메일은 110번 등을 사용한다.'

- 수신자 전송 계층에서는 헤더에서 port 번호를 읽고, segmented data를 시퀀싱, 재조립해서 수신한 데이터를 어플리케이션 계층으로 보낸다.

- 대표적인 전송 계층의 프로토콜로는 TCP와 UDP가 있다.

### TCP와 UDP

- TCP: TCP는 연결형 프로토콜로서, 데이터 전송의 순서를 보장하고 데이터 신뢰성을 보장한다. 데이터를 수신 받을 때, 어떤 이유로 데이터가 제대로 전송되지 않으면 재전송을 요청하기도 한다. 채팅 앱과 같이 데이터 신뢰성이 보장되어야 하는 어플리케이션의 경우 TCP를 쓴다.

- UDP: UDP 비연결형 프로토콜로서, TCP보다 전송 속도가 빠르다. UDP 데이터는 패킷이 아니라 데이터그램이라고 부른다(그럼에도 패킷으로 통칭할 수도 있다.). 주로 스트리밍/브로드캐스팅 서비스에 사용된다.

나머지 Session, Presentation, Application은 요약으로 정리하겠다.

### 요약하자면,

- Physical Layer => 시스템 간 물리적 연결과 전기신호 변환 및 제어를 담당한다.

- Data Link Layer => 네트워크 기기 간 데이터 전송 및 물리 주소 결정을 담당한다.

- Network Layer => 다른 네트워크와 통신을 위한 경로 설정 및 논리 주소 결정을 담당한다.

- Transport Layer => 신뢰할 수 있는 통신을 구현한다.

- Session Layer => 세션 체결, 통신 방식 등을 결정한다.

- Presentation Layer => 문자코드, 압축, 암호화 등의 데이터 변환을 담당한다.

- Application Layer => 이메일, 파일전송, 웹사이트 열람 등 어플리케이션에 대한 서비스를 제공한다.

대부분의 로컬 영역 네트워크에서는 49비트 물리주소를 사용한다. 이는 12자리의 16진수로 표현되며 예시는 다음과 같다.

### 07:01:02:01:2C:4B

다음 그림은 A -> P의 데이터 전달 과정의 예시 그림이다.

![image](https://github.com/Jaeboong/Study/assets/158824294/45e4b2ba-36af-4a2a-aac0-bf3858295ec5)

A는 P의 logical address만 알고 있으며 라우터에게 전달한다.

라우터는 연결된 동네마다 주소를 한개씩 가지고 있으며 라우터는 길을 알고있거나 모르더라도 요청을 통해 정보를 얻을 수 있다.




