# Delivery and Forwarding of IP packets

- 6장은 패킷이 어떻게 전달 되는가? 에 관심이 있다.

Delivery는 2가지 방식이 존재

- direct: 동일한 네트워크에 source, destination이 존재
- indirect: 반대의 경우


## Forwarding

- 패킷을 목적지로 가는 경로에 배치하는 과정을 의미, 이 기능을 수행하기 위해 호스트나 라우터가 라우팅 테이블을 가지고있다.
- 오늘날 인터넷은 매우 방대하고 복잡하기 때문에 단순이 라우팅 테이블에서 경로를 조회하는 것으로는 불가능
- 따라서 포워딩 기술을 통해 경로에 대한 정보를 얻는다.

### 포워딩 기술

- Next-hop: 다음 홉(라우터) 만을 라우팅 테이블에 저장해 라우팅 테이블의 크기를 줄임
- Network-Specific:  특정 네트워크에 대한 경로 정보만 라우팅 테이블이 저장
- Host-Specific: 특정 호스트에 대한 경로 정보를 라우팅 테이블이 저장
- Default-routing: 특정 경로 정보가 없을 때 ex) N2가 아니라면 모두 R2로 전송 과 같은 방법

### 클래스기반 주소체계에서의 포워딩

목적지 IP 주소의 첫 번째 몇 비트를 보고 어떤 클래스인지 쉽게 유추할 수 있어 목적지 네트워크를 식별하는 과정이 단순해진다.

클래스는 A, B, C만 사용한다. D, E클래스느 특별한 용도로 이미 예약되어있기 때문에 일반적인 포워딩 목적으로 사용되지 않는다.

일단 탐색을 하기 위해 3개의 테이블이 필요하다.

- Network address: 목적지 호스트가 어디 있는지
- Next-hop address: 다음 홉 주소는 indirect 전달의 경우 패킷이 어느 라우터에 전달되어야 하는지 알려준다. (direct의 경우 이 테이블은 비어있다. 필요가 없기 때문)
- Interface number: interface number를 통해 어느 홉으로 나가야하는지 정보를 얻는다.

![image](https://github.com/Jaeboong/Study/assets/158824294/6808adb0-8835-49b9-916f-4cd8b3ca6f4a)

간단한 포워딩 모듈은 다음 과정을 따른다.

1. 패킷의 목적지 주소 추출
2. 목적지 주소의 복사본을 사용해 주소의 클래스 정보 얻기, 이것은 주소 복사본을 오른쪽으로 28비트 쉬프트하여 알 수 있다. 결과는 0~15사이 값을 가지는 4비트 수이다.
3. 0~7은 A, 8~11은 B, 12or13은 C, 14는 D, 15는 E이다.

![image](https://github.com/Jaeboong/Study/assets/158824294/0107e910-5422-4147-be30-3219b9a51792)

가상 네트워트를 라우팅 테이블로 변환하면 위 사진과 같다.


 
