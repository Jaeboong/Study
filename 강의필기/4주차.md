## LAN (Local Areak Networks)

Lan은 local에서 사용하기 위해 설계된 네트워크이다.

### Ethernet Frame

이더넷 프레임이란? 데이터링크 레이어에서 사용되는 전송 메커니즘이다.

이더넷 프레임은 데이터를 담는 컨테이너라고 생각하면 쉽다.

![image](https://github.com/Jaeboong/Study/assets/158824294/02e96a6e-1179-4271-ad82-f360c2cc8871)

- Preamble: 수신측에 프레임 도착 통지, 시스템 타이머 동기 맞춤
- SFD (Start Frame Delimiter): 프레임 시작을 알림
- Destination address: 다음 국의 물리주소
- Source address: 이전 국의 물리주소
- Type: 데이터 유형 지정
- Data: 상위층으로 부터 받은 데이터
- CRC: 오류검출

## CSMA / CD

- LAN의 통신 프로토콜 종류 중 하나이며, 이더넷 환경에서 사용한다.
- CSMA/CD 는 Carrier Sense Multiple Access/Collision Detection의 줄임말로 즉 '대충 알아서 눈치 껏 통신하자'라는 방식의 프로토콜이다.

### CSMA/CD의 방식

- 이더넷 환경에서 통신을 하고 싶은 PC나 서버는 먼저 네트워크 상에 통신이 일어나는지 확인한다. Carrier sense. 캐리어가 있는지 확인한다.

```
캐리어란? 네트워크 상 나타내는 신호
```

- 네트워크 통신이 일어나고 있으면 (캐리어가 감지되면) 데이터를 보내지 않고 기다린다.

- 네트워크 통신이 일어나고 있지 않으면 (캐리어가 감지되지 않으면) 데이터를 네트워크 상에 보낸다
즉 '눈치를보다가 보낸다.'

- 만약, 캐리어가 감지 되지 않았을 때, 두 PC나 서버가 데이터를 동시에 보내면 이 경우를 Multiple Aceess (다중 접근)이라 한다.

- 위 처럼 두 PC나 서버가 데이터를 동시에 보내려다 부딪치는 경우 충돌(Collision) 이 발생했다고 한다.

- 만약, 충돌이 일어나게 된다면 데이터를 전송했던 두 PC나 서버들은 랜덤한 시간 동안 기다린 다음 다시 데이터를 전송 한다.

![image](https://github.com/Jaeboong/Study/assets/158824294/263134a3-37af-4fbe-822b-ce6d537fa354)

![image](https://github.com/Jaeboong/Study/assets/158824294/c0a80585-2b73-4128-8a7e-bc199b390888)

CSMA가 작동할 때 프레임의 크기가 너무 크면 데이터의 충돌을 감지했을 때 끊기 어려우므로 크기를 제한해야 한다.

또 프레임의 전송시간은 A에서 B로 보낸다고 가정할 때 A->B 전송시간의 2배 이상이어야 한다.

## Wired LAN, Extended service sets (ESS)

![image](https://github.com/Jaeboong/Study/assets/158824294/f91e4512-12b8-495d-9019-b6e76eeff9d1)

다수의 BBS에 걸려있는 단말들은 해당 AP들을 모두 사용할 수 있다.

### Wireless LAN, CSMA

무선 LAN은 3가지 이유로 CSMA/CD를 구현할 수 없다.

- 충돌감지를 위해 한 스테이션이 동시에 데이터를 전송하고 충돌 신호를 수신할 수 있어야 한다. 이는 높은 비용의 스테이션과 증가된 대역폭을 요구하므로 무리다.
- 단말기가 숨겨져있으면 충돌이 감지되지 않을 수 있다.
- 신호 강도는 거리의 제곱에 반비례하여 감소한다. 무선의 경우 신호가 빠르게 소실되므로 한계가 있다.

따라서 무선랜에서는 CSMA/CA (Collision Avoid)를 사용한다.

CSMA/CA방식은 데이터를 전송하기 전에 RTS(Ready to send)를 보내 채널 상태가 어떤지 물어보고 CTS(Clear to send)를 받으면 그 때 Data를 보내는 방식이다.

### NAV

NAV는 Network Allocation Vector의 약자로 다른 장치들에게 특정 시간동안 채널을 사용할 것임을 알리는 방법이다. 이는 RTS, CTS 제어 프레임과 함께 사용된다. 다른 장치들은 NAV가 만료될 때까지 채널 접근을 보류함으로써 충돌 가능성을 줄인다.

충돌을 막기위해 CSMA/CA와 NAV를 사용하지만 그럼에도 불구하고 충돌은 생기긴 한다. 

![image](https://github.com/Jaeboong/Study/assets/158824294/310fe29c-2de9-41d2-a4bb-8e1717e21377)

## MAC Sublayer

### DCF

MAC sublayer는 여러 장치가 공유 통신 채널에 접근하는 방식을 제어하는 규칙과 프로토콜을 정의한다.

주로 DCF를 통해 이루어지며 DCF는 CSMA/CA 메커니즘을 사용해 장치들의 충돌을 최소화하며 채널을 공유한다.

여기서 NAV가 사용되는데 NAV는 위 언급과 마찬가지로 해당 채널을 자신이 사용하고있음을 알리는 타이머이다.

송신자는 RTS를 보내고 수신자는 CTS로 응답하여 채널 사용준비가 되었음을 알리는데 이 때 CTS를 받지 못하면 송신자는 충돌이 일어났다고 가정하고 백오프 전략을 사용한다.

Back off 전략이란 임의의 시간동안 대기한 뒤 다시 채널을 사용하려고 시도하는 것이다. 이 때 모두가 같은 시간에 다시 시도하려하면 또 다시 충돌이 발생하므로 무작위 지연 시간을 설정하고 다시 채널에 접근하는 시도를 한다.

### PCF

Point Coordination Function 의 약자로 중앙 집중식 접근 제어를 사용한다. 판단하는 주체가 있고 주체자가 허락해야 채널을 사용할 수 있다. 따라서 충돌이 날 일이 없고 Coordinater가 채널 사용 시간을 보장해준다.

하지만 단점도 있다. 해야 할 일이 늘어난다.

MAC 계층에서는 다양한 우선순위를 위해 다른 인터 프레임 간격을 통해 정의한다.

SIFS -> PIFS -> DIFS 순으로 우선순위가 높다.

## Frame format

어떤 형태인지정도는 알아두자.

![image](https://github.com/Jaeboong/Study/assets/158824294/bf6b1167-baba-4271-a16b-cb2b8f7adb39)

Rsvd는 나중을 위해 아껴둔 비트이다.

## Control frames

![image](https://github.com/Jaeboong/Study/assets/158824294/4eb2b5db-508a-440b-9061-ae158d4aef76)

## 3.19 숨겨진 지국 문제

![image](https://github.com/Jaeboong/Study/assets/158824294/ff5c24b2-2eb6-4142-9898-8416657c6a56)

지국 B는 A에게 데이터를 전송한다. 지국 C도 A에게 전송을 한다.

지국 B의 범위에는 C가 없고 C도 마찬가지로 B가 범위안에 없기 때문에 서로 A에게 데이터를 전송하는지 모른다.

따라서 충돌이 발생하는데 이를 핸드셰이크 프레임(RTS, CTS)로 해결할 수 있다.

![image](https://github.com/Jaeboong/Study/assets/158824294/dc09b15c-e96d-487f-b8ff-47b02452c738)

다음 그림처럼 A는 B에게만 RTS를 받았지만 A의 범위 안에있는 모든 지국에게 CTS를 보내므로써 A의 범위안에 있는 지국들은 A가 현재 데이터를 전송받고 있음을 알고 데이터를 보내지 않고 기다린다.

![image](https://github.com/Jaeboong/Study/assets/158824294/def0fb9d-5dda-4f2e-aae6-46cf49b059f9)

하지만 위 경우는 핸드셰이크 프레임을 사용해도 해결할 수 없다. 

![image](https://github.com/Jaeboong/Study/assets/158824294/fa225093-14e1-4e32-8324-b354765762d7)

A가 B에게 데이터를 보내려고 RTS를 보냈다. B는 A의 RTS를 받고 CTS를 전송한다. C도 A의 범의 안이므로 A의 RTS를 받는다. B의 CTS를 받고 A는 데이터 전송을 시작한다. C는 A의 RTS 때문에 잠시 대기하고있다가 데이터를 전송하기 시작하는데 이 때 C는 B의 범위 밖이기 때문에 사실 진작 데이터를 전송했어도 무관하다. 하지만 핸드셰이크 프레임 때문에 네트워크의 채널 용량을 낭비했다. 이를 노드 C는 노드 A로부터 "노출" 되어있다고 말한다.

## Radio Layer

- 2.4 GHz ISM bands
- Hop time 625 msec

![image](https://github.com/Jaeboong/Study/assets/158824294/228b2ad1-590f-40d8-b6f2-24875553776e)

Frequency Hopping priciple 방식으로 데이터를 전송하는데 이렇게 전송했을 때 채널을 빠르게 바꾸면서 신호를 전송하기 때문에 간섭을 감소시킬 수 있고 특정 주파수에 집중되어 있는 경우에도 짧은 시간동안만 해당 주파수에 머무르므로 안정성이 올라간다.

주파수의 도약패턴을 알고있는 통신 장치만이 데이터를 정확하게 받을 수 있고 무단 감청이나 데이터 탈취를 어렵게 만든다.




